# ü§† Cowboy Deploy CLI

Smart FTP deployment tool for Laravel, Statamic, and PHP projects.

## Features

- üöÄ **Smart incremental deploys** using git-ftp (only uploads changed files)
- üìã **Auto-detects config** from `.env`, `deploy.php`, `.ftpconfig`
- üéØ **Per-project configuration** stored in `.cowboy-deploy.json`
- üîÑ **Deployment history** with git commit tracking
- ‚Ü©Ô∏è **Rollback support** to previous deployments
- üèóÔ∏è **Asset building** (npm run build) before deployment
- üì¶ **Smart composer install** (only when composer.lock changes)
- üîç **Dry-run mode** to preview deployments

## Installation

Currently installed locally at: `~/.local/bin/cowboy`

```bash
cowboy --version
```

## Commands

### `cowboy init`

Initialize deployment configuration for your project.

**Features:**
- Reads FTP credentials from `.env` (FTP_HOST, FTP_USER, FTP_PASSWORD, etc.)
- Reads from `deploy.php` and `.ftpconfig` if available
- Auto-detects project type (Laravel, Statamic, generic PHP, Node)
- Creates `.cowboy-deploy.json` and adds it to `.gitignore`

**Usage:**
```bash
cowboy init
cowboy init --force  # Overwrite existing config
```

### `cowboy push`

Deploy your project to FTP server.

**Features:**
- Tests FTP connection before deploying
- Warns about uncommitted git changes
- Builds assets (`npm run build`) if configured
- Runs `composer install --no-dev --optimize-autoloader` if composer.lock changed
- Uses **git-ftp** for incremental deploys (only changed files!)
- Falls back to ncftpput for full uploads
- Tracks deployment history with git commits

**Usage:**
```bash
cowboy push              # Smart incremental deploy
cowboy push --full       # Force full deployment
cowboy push --dry-run    # Preview without deploying
```

### `cowboy status`

Show current deployment status and configuration.

**Shows:**
- Project info and type
- FTP configuration (without password)
- Git branch, commit, uncommitted changes
- Deployment history summary
- Build options

**Usage:**
```bash
cowboy status
```

### `cowboy log`

Show deployment history.

**Usage:**
```bash
cowboy log              # Show last 10 deployments
cowboy log --limit=20   # Show last 20 deployments
```

### `cowboy rollback`

Rollback to a previous deployment.

**Features:**
- Interactive selection from recent deployments
- Checks out git commit from target deployment
- Runs full deployment at that state
- Automatically stashes uncommitted changes
- Returns to current branch after rollback

**Requirements:**
- Git repository
- Deployments must have git commit references

**Usage:**
```bash
cowboy rollback           # Interactive selection
cowboy rollback --to=5    # Rollback to deployment #5
```

## Configuration

### `.env` File Support

Add these to your `.env` file for auto-detection:

```env
FTP_HOST=ftp.example.com
FTP_PORT=21
FTP_USER=username
FTP_PASSWORD=secret
FTP_PATH=/public_html
FTP_SECURE=false
```

### `.cowboy-deploy.json`

Generated by `cowboy init`. Contains:

```json
{
  "project": {
    "type": "laravel",
    "name": "my-project"
  },
  "ftp": {
    "host": "ftp.example.com",
    "port": 21,
    "username": "user",
    "password": "pass",
    "path": "/public_html",
    "secure": false
  },
  "deploy": {
    "build_assets": true,
    "run_composer": true,
    "excluded_paths": [
      ".git",
      "node_modules",
      "tests",
      ".env"
    ]
  },
  "history": []
}
```

**‚ö†Ô∏è Security:** This file contains FTP credentials! It's automatically added to `.gitignore`.

## Workflow Example

```bash
# First time setup
cd my-laravel-project
cowboy init

# Deploy to production
cowboy push

# Check status
cowboy status

# View deployment history
cowboy log

# Oh no! Something broke!
cowboy rollback
```

## Requirements

- PHP 8.1+
- Git (for rollback and incremental deploys)
- git-ftp (installed automatically, used for smart deploys)
- ncftp (fallback for full uploads)

## Development

Built with Laravel Zero.

**Location:** `~/Code/php/cowboy-deploy-cli`

**Edit commands:**
```bash
cd ~/Code/php/cowboy-deploy-cli
php cowboy make:command NewCommand
```

## Tips

- Always commit your code before deploying
- Use `--dry-run` to preview deployments
- Keep deployment history for easy rollbacks
- Set `build_assets: false` if you build locally
- Use `--full` flag if incremental deploy has issues

---

Made with ‚ù§Ô∏è for hassle-free FTP deployments ü§†
